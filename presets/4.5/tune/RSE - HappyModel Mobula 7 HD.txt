#$ TITLE: RSE - TUNE - HappyModel Mobula 7 HD
#$ FIRMWARE_VERSION: 4.5
#$ CATEGORY: TUNE
#$ STATUS: COMMUNITY
#$ KEYWORDS: RSE, hyperion
#$ AUTHOR: hyperion

#$ PARSER: MARKED

#$ DESCRIPTION:
#$ DESCRIPTION: <img src="https://user-images.githubusercontent.com/19867640/174759844-ffd85f42-1f1c-42bf-9032-d9f96d4d9619.svg" width="90px" style="display: block; float: left; margin-right: 10px; margin-top: 20px"/>
#$ DESCRIPTION: <h1>HappyModel Mobula 7 HD settings for BF 4.5</h1>
#$ DESCRIPTION: <br>
#$ DESCRIPTION:
#$ DESCRIPTION: These are the craft-specific settings for the HappyModel Mobula 7 HD running Betaflight 4.5
#$ DESCRIPTION:
#$ DESCRIPTION: <br>
#$ DESCRIPTION:

#$ DISCUSSION: none


### Drone Specific
set craft_name = MOBSNAIL
set pilot_name = CH

# resources

# timer

# dma
dma pin A09 NONE
dma pin A10 NONE

# feature
feature TELEMETRY
feature OSD

# serial
serial 1 131073 115200 57600 0 115200		# Avatar VTX

# PID loop
set pid_process_denom = 4			# Slower clock for older F411 ECU

# motors
set dshot_burst = OFF
set dshot_bidir = ON
set dshot_bitbang = AUTO
set motor_pwm_protocol = DSHOT300
set motor_poles = 12
set yaw_motors_reversed = ON

# power system
set vbat_max_cell_voltage = 440
set vbat_min_cell_voltage = 320
set ibata_scale = 470
set report_cell_voltage = ON

# sensors and I/O
set small_angle = 180
set acc_calibration = -63,35,-61,1

# ELRS
set expresslrs_uid = 131,196,152,144,107,134
set expresslrs_rate_index = 1
set expresslrs_switch_mode = HYBRID

# GPS

# camera

# logging
set blackbox_device = NONE
set debug_mode = RX_EXPRESSLRS_SPI


### Base settings
#$ INCLUDE: presets/4.5/other/rse_base.txt


### RC Link
# Use ExpressLRS 250Hz preset with HD Freestyle, SPI RX, and singe cell voltage


### Tune

# master
set gyro_lpf1_static_hz = 300
set gyro_lpf2_static_hz = 600
set dyn_notch_count = 1
set dyn_notch_q = 500
set gyro_lpf1_dyn_min_hz = 300
set gyro_lpf1_dyn_max_hz = 600
set fpv_mix_degrees = 30
set deadband = 1
set yaw_deadband = 1
set simplified_gyro_filter_multiplier = 120
set gyro_1_sensor_align = CW0FLIP
set gyro_1_align_pitch = 1800
set gyro_1_align_yaw = 0


### Profiles

profile 0

# profile 0
set dterm_lpf1_dyn_min_hz = 90
set dterm_lpf1_dyn_max_hz = 180
set dterm_lpf2_static_hz = 180
set iterm_relax = RPY
set p_pitch = 51
set i_pitch = 92
set d_pitch = 52
set f_pitch = 95
set p_roll = 49
set i_roll = 88
set d_roll = 46
set f_roll = 90
set p_yaw = 49
set i_yaw = 88
set f_yaw = 90
set d_min_roll = 34
set d_min_pitch = 39
set feedforward_transition = 21
set simplified_pids_mode = OFF
set simplified_d_gain = 115
set simplified_pi_gain = 110
set simplified_dterm_filter = OFF
set simplified_dterm_filter_multiplier = 120

# restore original profile selection
profile 0


### OSD
#$ INCLUDE: presets/4.5/other/osd_base.txt
#$ INCLUDE: presets/4.5/other/avatar.txt


### Rateprofiles
rateprofile 0

# rateprofile 0
set rateprofile_name = FREE_HI
set roll_rc_rate = 15
set pitch_rc_rate = 15
set yaw_rc_rate = 10
set roll_expo = 70
set pitch_expo = 70
set yaw_expo = 70
set roll_srate = 80
set pitch_srate = 80
set yaw_srate = 80
set throttle_limit_type = SCALE
set throttle_limit_percent = 98

rateprofile 1

# rateprofile 1
set rateprofile_name = FREE_MID
set thr_mid = 42			# better throttle control
set thr_expo = 30			# better throttle control
set roll_rc_rate = 16
set pitch_rc_rate = 16
set yaw_rc_rate = 14
set roll_expo = 56
set pitch_expo = 56
set yaw_expo = 43
set roll_srate = 53
set pitch_srate = 53
set yaw_srate = 35
set throttle_limit_type = SCALE
set throttle_limit_percent = 98

rateprofile 2

# rateprofile 2
set rateprofile_name = FREE_MID
set roll_rc_rate = 12
set pitch_rc_rate = 12
set yaw_rc_rate = 12
set roll_expo = 70
set pitch_expo = 70
set yaw_expo = 70
set roll_srate = 53
set pitch_srate = 53
set yaw_srate = 35
set throttle_limit_type = SCALE
set throttle_limit_percent = 98

rateprofile 3

# rateprofile 3
set rateprofile_name = TUNE
set roll_rc_rate = 20
set pitch_rc_rate = 20
set yaw_rc_rate = 20
set roll_expo = 57
set pitch_expo = 57
set yaw_expo = 55
set roll_srate = 20
set pitch_srate = 20
set yaw_srate = 20

# restore original rateprofile selection
rateprofile 0
